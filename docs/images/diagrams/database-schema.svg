<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000" width="1400" height="1000">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a2e; }
      .subtitle { font: 14px sans-serif; fill: #666; }
      .table-name { font: bold 14px sans-serif; fill: #fff; }
      .pk { font: bold 11px monospace; fill: #f59e0b; }
      .fk { font: bold 11px monospace; fill: #3b82f6; }
      .field { font: 11px monospace; fill: #333; }
      .type { font: 10px monospace; fill: #666; }
      .relation { stroke: #64748b; stroke-width: 1.5; fill: none; }
      .relation-label { font: 9px sans-serif; fill: #666; }
    </style>
    <marker id="one" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
      <line x1="4" y1="0" x2="4" y2="8" stroke="#64748b" stroke-width="2"/>
    </marker>
    <marker id="many" markerWidth="12" markerHeight="8" refX="8" refY="4" orient="auto">
      <path d="M0 4 L8 0 L8 8 Z" fill="none" stroke="#64748b" stroke-width="1.5"/>
    </marker>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#2563eb"/>
    </linearGradient>
    <linearGradient id="userHeaderGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    <linearGradient id="testHeaderGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>
    <linearGradient id="resultHeaderGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6"/>
      <stop offset="100%" style="stop-color:#7c3aed"/>
    </linearGradient>
    <linearGradient id="artifactHeaderGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ec4899"/>
      <stop offset="100%" style="stop-color:#db2777"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1000" fill="#f8fafc"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">QA Guardian Database Schema</text>
  <text x="700" y="62" text-anchor="middle" class="subtitle">Entity-Relationship Diagram - PostgreSQL</text>

  <!-- ===== ORGANIZATIONS TABLE ===== -->
  <g transform="translate(50, 100)">
    <rect width="200" height="160" rx="6" fill="#fff" stroke="#3b82f6" stroke-width="2"/>
    <rect width="200" height="30" rx="6" fill="url(#headerGrad)"/>
    <rect x="0" y="25" width="200" height="5" fill="url(#headerGrad)"/>
    <text x="100" y="22" text-anchor="middle" class="table-name">organizations</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="100" y="50" class="type">UUID</text>

    <text x="10" y="70" class="field">name</text>
    <text x="100" y="70" class="type">VARCHAR(255)</text>

    <text x="10" y="90" class="field">slug</text>
    <text x="100" y="90" class="type">VARCHAR(100)</text>

    <text x="10" y="110" class="field">logo_url</text>
    <text x="100" y="110" class="type">TEXT</text>

    <text x="10" y="130" class="field">settings</text>
    <text x="100" y="130" class="type">JSONB</text>

    <text x="10" y="150" class="field">created_at</text>
    <text x="100" y="150" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== USERS TABLE ===== -->
  <g transform="translate(300, 100)">
    <rect width="220" height="200" rx="6" fill="#fff" stroke="#10b981" stroke-width="2"/>
    <rect width="220" height="30" rx="6" fill="url(#userHeaderGrad)"/>
    <rect x="0" y="25" width="220" height="5" fill="url(#userHeaderGrad)"/>
    <text x="110" y="22" text-anchor="middle" class="table-name">users</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="120" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK org_id</text>
    <text x="120" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">email</text>
    <text x="120" y="90" class="type">VARCHAR(255)</text>

    <text x="10" y="110" class="field">name</text>
    <text x="120" y="110" class="type">VARCHAR(255)</text>

    <text x="10" y="130" class="field">password_hash</text>
    <text x="120" y="130" class="type">VARCHAR(255)</text>

    <text x="10" y="150" class="field">role</text>
    <text x="120" y="150" class="type">ENUM</text>

    <text x="10" y="170" class="field">avatar_url</text>
    <text x="120" y="170" class="type">TEXT</text>

    <text x="10" y="190" class="field">created_at</text>
    <text x="120" y="190" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== PROJECTS TABLE ===== -->
  <g transform="translate(50, 320)">
    <rect width="200" height="180" rx="6" fill="#fff" stroke="#3b82f6" stroke-width="2"/>
    <rect width="200" height="30" rx="6" fill="url(#headerGrad)"/>
    <rect x="0" y="25" width="200" height="5" fill="url(#headerGrad)"/>
    <text x="100" y="22" text-anchor="middle" class="table-name">projects</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="100" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK org_id</text>
    <text x="100" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">name</text>
    <text x="100" y="90" class="type">VARCHAR(255)</text>

    <text x="10" y="110" class="field">slug</text>
    <text x="100" y="110" class="type">VARCHAR(100)</text>

    <text x="10" y="130" class="field">description</text>
    <text x="100" y="130" class="type">TEXT</text>

    <text x="10" y="150" class="field">base_url</text>
    <text x="100" y="150" class="type">TEXT</text>

    <text x="10" y="170" class="field">settings</text>
    <text x="100" y="170" class="type">JSONB</text>
  </g>

  <!-- ===== TEST_SUITES TABLE ===== -->
  <g transform="translate(300, 360)">
    <rect width="220" height="160" rx="6" fill="#fff" stroke="#f59e0b" stroke-width="2"/>
    <rect width="220" height="30" rx="6" fill="url(#testHeaderGrad)"/>
    <rect x="0" y="25" width="220" height="5" fill="url(#testHeaderGrad)"/>
    <text x="110" y="22" text-anchor="middle" class="table-name">test_suites</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="120" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK project_id</text>
    <text x="120" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">name</text>
    <text x="120" y="90" class="type">VARCHAR(255)</text>

    <text x="10" y="110" class="field">description</text>
    <text x="120" y="110" class="type">TEXT</text>

    <text x="10" y="130" class="field">config</text>
    <text x="120" y="130" class="type">JSONB</text>

    <text x="10" y="150" class="field">created_at</text>
    <text x="120" y="150" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== TESTS TABLE ===== -->
  <g transform="translate(570, 360)">
    <rect width="240" height="220" rx="6" fill="#fff" stroke="#f59e0b" stroke-width="2"/>
    <rect width="240" height="30" rx="6" fill="url(#testHeaderGrad)"/>
    <rect x="0" y="25" width="240" height="5" fill="url(#testHeaderGrad)"/>
    <text x="120" y="22" text-anchor="middle" class="table-name">tests</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="130" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK suite_id</text>
    <text x="130" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">name</text>
    <text x="130" y="90" class="type">VARCHAR(255)</text>

    <text x="10" y="110" class="field">type</text>
    <text x="130" y="110" class="type">ENUM (e2e, perf...)</text>

    <text x="10" y="130" class="field">steps</text>
    <text x="130" y="130" class="type">JSONB</text>

    <text x="10" y="150" class="field">config</text>
    <text x="130" y="150" class="type">JSONB</text>

    <text x="10" y="170" class="field">target_url</text>
    <text x="130" y="170" class="type">TEXT</text>

    <text x="10" y="190" class="field">tags</text>
    <text x="130" y="190" class="type">TEXT[]</text>

    <text x="10" y="210" class="field">created_at</text>
    <text x="130" y="210" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== TEST_RUNS TABLE ===== -->
  <g transform="translate(860, 100)">
    <rect width="240" height="260" rx="6" fill="#fff" stroke="#8b5cf6" stroke-width="2"/>
    <rect width="240" height="30" rx="6" fill="url(#resultHeaderGrad)"/>
    <rect x="0" y="25" width="240" height="5" fill="url(#resultHeaderGrad)"/>
    <text x="120" y="22" text-anchor="middle" class="table-name">test_runs</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="130" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK suite_id</text>
    <text x="130" y="70" class="type">UUID</text>

    <text x="10" y="90" class="fk">FK triggered_by</text>
    <text x="130" y="90" class="type">UUID (user)</text>

    <text x="10" y="110" class="field">status</text>
    <text x="130" y="110" class="type">ENUM</text>

    <text x="10" y="130" class="field">browser</text>
    <text x="130" y="130" class="type">VARCHAR(50)</text>

    <text x="10" y="150" class="field">started_at</text>
    <text x="130" y="150" class="type">TIMESTAMP</text>

    <text x="10" y="170" class="field">completed_at</text>
    <text x="130" y="170" class="type">TIMESTAMP</text>

    <text x="10" y="190" class="field">duration_ms</text>
    <text x="130" y="190" class="type">INTEGER</text>

    <text x="10" y="210" class="field">pass_count</text>
    <text x="130" y="210" class="type">INTEGER</text>

    <text x="10" y="230" class="field">fail_count</text>
    <text x="130" y="230" class="type">INTEGER</text>

    <text x="10" y="250" class="field">metadata</text>
    <text x="130" y="250" class="type">JSONB</text>
  </g>

  <!-- ===== TEST_RESULTS TABLE ===== -->
  <g transform="translate(860, 400)">
    <rect width="240" height="240" rx="6" fill="#fff" stroke="#8b5cf6" stroke-width="2"/>
    <rect width="240" height="30" rx="6" fill="url(#resultHeaderGrad)"/>
    <rect x="0" y="25" width="240" height="5" fill="url(#resultHeaderGrad)"/>
    <text x="120" y="22" text-anchor="middle" class="table-name">test_results</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="130" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK run_id</text>
    <text x="130" y="70" class="type">UUID</text>

    <text x="10" y="90" class="fk">FK test_id</text>
    <text x="130" y="90" class="type">UUID</text>

    <text x="10" y="110" class="field">status</text>
    <text x="130" y="110" class="type">ENUM (pass/fail)</text>

    <text x="10" y="130" class="field">duration_ms</text>
    <text x="130" y="130" class="type">INTEGER</text>

    <text x="10" y="150" class="field">error_message</text>
    <text x="130" y="150" class="type">TEXT</text>

    <text x="10" y="170" class="field">step_results</text>
    <text x="130" y="170" class="type">JSONB</text>

    <text x="10" y="190" class="field">metrics</text>
    <text x="130" y="190" class="type">JSONB</text>

    <text x="10" y="210" class="field">retry_count</text>
    <text x="130" y="210" class="type">INTEGER</text>

    <text x="10" y="230" class="field">created_at</text>
    <text x="130" y="230" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== ARTIFACTS TABLE ===== -->
  <g transform="translate(1150, 100)">
    <rect width="220" height="200" rx="6" fill="#fff" stroke="#ec4899" stroke-width="2"/>
    <rect width="220" height="30" rx="6" fill="url(#artifactHeaderGrad)"/>
    <rect x="0" y="25" width="220" height="5" fill="url(#artifactHeaderGrad)"/>
    <text x="110" y="22" text-anchor="middle" class="table-name">artifacts</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="120" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK result_id</text>
    <text x="120" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">type</text>
    <text x="120" y="90" class="type">ENUM</text>

    <text x="10" y="110" class="field">name</text>
    <text x="120" y="110" class="type">VARCHAR(255)</text>

    <text x="10" y="130" class="field">storage_key</text>
    <text x="120" y="130" class="type">TEXT</text>

    <text x="10" y="150" class="field">size_bytes</text>
    <text x="120" y="150" class="type">BIGINT</text>

    <text x="10" y="170" class="field">content_type</text>
    <text x="120" y="170" class="type">VARCHAR(100)</text>

    <text x="10" y="190" class="field">created_at</text>
    <text x="120" y="190" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== API_KEYS TABLE ===== -->
  <g transform="translate(570, 100)">
    <rect width="240" height="200" rx="6" fill="#fff" stroke="#10b981" stroke-width="2"/>
    <rect width="240" height="30" rx="6" fill="url(#userHeaderGrad)"/>
    <rect x="0" y="25" width="240" height="5" fill="url(#userHeaderGrad)"/>
    <text x="120" y="22" text-anchor="middle" class="table-name">api_keys</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="130" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK org_id</text>
    <text x="130" y="70" class="type">UUID</text>

    <text x="10" y="90" class="fk">FK created_by</text>
    <text x="130" y="90" class="type">UUID (user)</text>

    <text x="10" y="110" class="field">name</text>
    <text x="130" y="110" class="type">VARCHAR(255)</text>

    <text x="10" y="130" class="field">key_hash</text>
    <text x="130" y="130" class="type">VARCHAR(255)</text>

    <text x="10" y="150" class="field">scopes</text>
    <text x="130" y="150" class="type">TEXT[]</text>

    <text x="10" y="170" class="field">last_used_at</text>
    <text x="130" y="170" class="type">TIMESTAMP</text>

    <text x="10" y="190" class="field">expires_at</text>
    <text x="130" y="190" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== SCHEDULES TABLE ===== -->
  <g transform="translate(50, 560)">
    <rect width="220" height="180" rx="6" fill="#fff" stroke="#f59e0b" stroke-width="2"/>
    <rect width="220" height="30" rx="6" fill="url(#testHeaderGrad)"/>
    <rect x="0" y="25" width="220" height="5" fill="url(#testHeaderGrad)"/>
    <text x="110" y="22" text-anchor="middle" class="table-name">schedules</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="120" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK suite_id</text>
    <text x="120" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">name</text>
    <text x="120" y="90" class="type">VARCHAR(255)</text>

    <text x="10" y="110" class="field">cron_expression</text>
    <text x="120" y="110" class="type">VARCHAR(100)</text>

    <text x="10" y="130" class="field">timezone</text>
    <text x="120" y="130" class="type">VARCHAR(50)</text>

    <text x="10" y="150" class="field">enabled</text>
    <text x="120" y="150" class="type">BOOLEAN</text>

    <text x="10" y="170" class="field">next_run_at</text>
    <text x="120" y="170" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== BASELINES TABLE ===== -->
  <g transform="translate(320, 620)">
    <rect width="220" height="160" rx="6" fill="#fff" stroke="#ec4899" stroke-width="2"/>
    <rect width="220" height="30" rx="6" fill="url(#artifactHeaderGrad)"/>
    <rect x="0" y="25" width="220" height="5" fill="url(#artifactHeaderGrad)"/>
    <text x="110" y="22" text-anchor="middle" class="table-name">visual_baselines</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="120" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK test_id</text>
    <text x="120" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">screenshot_key</text>
    <text x="120" y="90" class="type">TEXT</text>

    <text x="10" y="110" class="field">hash</text>
    <text x="120" y="110" class="type">VARCHAR(64)</text>

    <text x="10" y="130" class="field">viewport</text>
    <text x="120" y="130" class="type">JSONB</text>

    <text x="10" y="150" class="field">created_at</text>
    <text x="120" y="150" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== ALERTS TABLE ===== -->
  <g transform="translate(590, 620)">
    <rect width="220" height="180" rx="6" fill="#fff" stroke="#3b82f6" stroke-width="2"/>
    <rect width="220" height="30" rx="6" fill="url(#headerGrad)"/>
    <rect x="0" y="25" width="220" height="5" fill="url(#headerGrad)"/>
    <text x="110" y="22" text-anchor="middle" class="table-name">alert_channels</text>

    <text x="10" y="50" class="pk">PK id</text>
    <text x="120" y="50" class="type">UUID</text>

    <text x="10" y="70" class="fk">FK project_id</text>
    <text x="120" y="70" class="type">UUID</text>

    <text x="10" y="90" class="field">type</text>
    <text x="120" y="90" class="type">ENUM</text>

    <text x="10" y="110" class="field">config</text>
    <text x="120" y="110" class="type">JSONB</text>

    <text x="10" y="130" class="field">enabled</text>
    <text x="120" y="130" class="type">BOOLEAN</text>

    <text x="10" y="150" class="field">last_sent_at</text>
    <text x="120" y="150" class="type">TIMESTAMP</text>

    <text x="10" y="170" class="field">created_at</text>
    <text x="120" y="170" class="type">TIMESTAMP</text>
  </g>

  <!-- ===== RELATIONSHIP LINES ===== -->

  <!-- organizations -> users (1:N) -->
  <path d="M250 180 L300 180" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- organizations -> projects (1:N) -->
  <path d="M150 260 L150 320" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- organizations -> api_keys (1:N) -->
  <path d="M250 150 L570 150" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- projects -> test_suites (1:N) -->
  <path d="M250 440 L300 440" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- projects -> alert_channels (1:N) -->
  <path d="M150 500 L150 730 L590 730" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- test_suites -> tests (1:N) -->
  <path d="M520 440 L570 440" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- test_suites -> test_runs (1:N) -->
  <path d="M410 360 L410 340 L840 340 L840 200 L860 200" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- test_suites -> schedules (1:N) -->
  <path d="M300 500 L280 500 L280 640 L270 640" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- tests -> test_results (N:1) -->
  <path d="M810 480 L860 480" class="relation" marker-start="url(#many)" marker-end="url(#one)"/>

  <!-- tests -> visual_baselines (1:N) -->
  <path d="M690 580 L690 600 L540 600 L540 700" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- test_runs -> test_results (1:N) -->
  <path d="M980 360 L980 400" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- test_results -> artifacts (1:N) -->
  <path d="M1100 520 L1130 520 L1130 300 L1150 300" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>

  <!-- ===== LEGEND ===== -->
  <g transform="translate(1150, 350)">
    <rect width="220" height="180" rx="6" fill="#f1f5f9" stroke="#64748b"/>
    <text x="110" y="25" text-anchor="middle" class="subtitle" style="font-weight:bold;">Legend</text>

    <text x="15" y="55" class="pk">PK</text>
    <text x="45" y="55" class="field">Primary Key</text>

    <text x="15" y="80" class="fk">FK</text>
    <text x="45" y="80" class="field">Foreign Key</text>

    <line x1="15" y1="105" x2="55" y2="105" class="relation" marker-start="url(#one)" marker-end="url(#many)"/>
    <text x="65" y="110" class="field">One-to-Many</text>

    <rect x="15" y="125" width="15" height="15" fill="url(#headerGrad)" rx="2"/>
    <text x="40" y="137" class="field">Core Tables</text>

    <rect x="15" y="150" width="15" height="15" fill="url(#testHeaderGrad)" rx="2"/>
    <text x="40" y="162" class="field">Test Tables</text>
  </g>

  <!-- ===== ENUM VALUES BOX ===== -->
  <g transform="translate(1150, 560)">
    <rect width="220" height="190" rx="6" fill="#f1f5f9" stroke="#64748b"/>
    <text x="110" y="25" text-anchor="middle" class="subtitle" style="font-weight:bold;">Enum Types</text>

    <text x="15" y="50" class="field" style="font-weight:bold;">user_role:</text>
    <text x="15" y="68" class="type">owner, admin, developer, viewer</text>

    <text x="15" y="95" class="field" style="font-weight:bold;">test_type:</text>
    <text x="15" y="113" class="type">e2e, visual, performance, load, a11y</text>

    <text x="15" y="140" class="field" style="font-weight:bold;">run_status:</text>
    <text x="15" y="158" class="type">pending, running, passed, failed</text>

    <text x="15" y="185" class="field" style="font-weight:bold;">artifact_type:</text>
    <text x="15" y="203" class="type">screenshot, trace, video, log</text>
  </g>

  <!-- Version info -->
  <text x="700" y="980" text-anchor="middle" class="subtitle">QA Guardian v1.0 - Database Schema - PostgreSQL 15+</text>
</svg>
