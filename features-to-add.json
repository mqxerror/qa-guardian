{
  "title": "Remove In-Memory Maps - Use Database-Only Storage",
  "updated": "2026-01-28",
  "total_features": 23,
  "total_memory_maps_to_remove": 93,
  "phases": 4,
  "priority_breakdown": {
    "critical": 12,
    "high": 6,
    "medium": 5
  },
  "current_state": {
    "note": "Features #2100-2103 were partially done: replaced memory Maps with isDatabaseConnected() guards and Proxy wrappers. The Proxy approach BROKE production. New requirement: COMPLETE removal of all Maps, Proxy, isDatabaseConnected() checks, and getMemory* functions.",
    "files_partially_done": [
      "backend/src/services/repositories/test-suites.ts (isDatabaseConnected guards added, getMemory* deprecated)",
      "backend/src/services/repositories/projects.ts (isDatabaseConnected guards added, getMemory* deprecated)",
      "backend/src/routes/test-suites/stores.ts (Proxy wrappers added - BROKE production)",
      "backend/src/routes/projects/stores.ts (Proxy wrappers added)",
      "backend/src/routes/api-keys/stores.ts (Proxy wrappers added)"
    ],
    "files_untouched": [
      "backend/src/services/repositories/organizations.ts (5 memory Maps)",
      "backend/src/services/repositories/auth.ts (3 memory Maps)",
      "backend/src/services/repositories/monitoring.ts (37 memory Maps - LARGEST)",
      "backend/src/services/repositories/dast.ts (6 memory Maps)",
      "backend/src/services/repositories/sast.ts (6 memory Maps)",
      "backend/src/services/repositories/github.ts (5 memory Maps)",
      "backend/src/services/repositories/ai-test-generator.ts (6 memory Maps)",
      "backend/src/services/repositories/audit-logs.ts (1 memory Map)",
      "backend/src/services/repositories/schedules.ts (1 memory Map)",
      "backend/src/services/repositories/reports.ts (1 memory Map)",
      "backend/src/services/repositories/api-keys.ts (4 memory Maps)",
      "backend/src/services/repositories/test-runs.ts (3 memory Maps)",
      "94 route files using Map operations"
    ]
  },
  "features": [
    {
      "id": 2100,
      "phase": 0,
      "category": "Database",
      "name": "Create Missing Database Tables for Memory Removal",
      "priority": "critical",
      "status": "pending",
      "description": "Before removing memory Maps, ensure all required PostgreSQL tables exist. Key missing: organization_members table."
    },
    {
      "id": 2101,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean test-suites Repository - Full DB-Only",
      "priority": "critical",
      "status": "pending",
      "description": "Remove ALL isDatabaseConnected() checks, getMemory*, getTestSuitesMap/getTestsMap from test-suites.ts"
    },
    {
      "id": 2102,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean projects Repository - Full DB-Only",
      "priority": "critical",
      "status": "pending",
      "description": "Remove ALL isDatabaseConnected() checks, 5 getMemory* functions, getProjectsMap from projects.ts"
    },
    {
      "id": 2103,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean organizations Repository - Full DB-Only",
      "priority": "critical",
      "status": "pending",
      "description": "Remove 5 memory Maps, ALL getMemory* functions, update seedDefaultOrganizations() to use PostgreSQL"
    },
    {
      "id": 2104,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean auth Repository - Remove Memory Maps",
      "priority": "critical",
      "status": "pending",
      "description": "Remove 3 memory Maps (memoryUsers, memoryUserSessions, memoryResetTokens) from auth.ts"
    },
    {
      "id": 2105,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean monitoring Repository - Remove 37 Memory Maps",
      "priority": "high",
      "status": "pending",
      "description": "LARGEST file: remove 37 memory Maps from monitoring.ts covering uptime, transactions, performance, webhooks, DNS, TCP, status pages, on-call, incidents, alerts"
    },
    {
      "id": 2106,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean dast Repository - Remove 6 Memory Maps",
      "priority": "medium",
      "status": "pending",
      "description": "Remove 6 memory Maps from dast.ts"
    },
    {
      "id": 2107,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean sast Repository - Remove 6 Memory Maps",
      "priority": "medium",
      "status": "pending",
      "description": "Remove 6 memory Maps from sast.ts"
    },
    {
      "id": 2108,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean github Repository - Remove 5 Memory Maps",
      "priority": "medium",
      "status": "pending",
      "description": "Remove 5 memory Maps from github.ts"
    },
    {
      "id": 2109,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean ai-test-generator Repository - Remove 6 Memory Maps",
      "priority": "medium",
      "status": "pending",
      "description": "Remove 6 memory Maps from ai-test-generator.ts"
    },
    {
      "id": 2110,
      "phase": 1,
      "category": "Backend/DataLayer",
      "name": "Clean Remaining Repositories - Remove Memory Maps",
      "priority": "medium",
      "status": "pending",
      "description": "Remove 10 memory Maps from 5 files: audit-logs (1), schedules (1), reports (1), api-keys (4), test-runs (3)"
    },
    {
      "id": 2111,
      "phase": 2,
      "category": "Backend/Routes",
      "name": "Remove Proxy Maps from test-suites stores.ts",
      "priority": "critical",
      "status": "pending",
      "description": "Remove Proxy-wrapped Map exports that BROKE production. Keep only async function exports."
    },
    {
      "id": 2112,
      "phase": 2,
      "category": "Backend/Routes",
      "name": "Remove Proxy Maps from projects stores.ts",
      "priority": "critical",
      "status": "pending",
      "description": "Remove 5 Proxy-wrapped Map exports. Keep only async function exports."
    },
    {
      "id": 2113,
      "phase": 2,
      "category": "Backend/Routes",
      "name": "Remove Proxy Maps from api-keys stores.ts",
      "priority": "high",
      "status": "pending",
      "description": "Remove 4 Proxy-wrapped Map exports. Keep only async function exports."
    },
    {
      "id": 2114,
      "phase": 2,
      "category": "Backend/Routes",
      "name": "Remove Memory from Remaining 6 stores.ts Files",
      "priority": "high",
      "status": "pending",
      "description": "Clean monitoring, github, dast, sast, ai-test-generator, reports stores.ts files"
    },
    {
      "id": 2115,
      "phase": 3,
      "category": "Backend/Routes",
      "name": "Migrate test-suites Route Files to Async DB Calls",
      "priority": "critical",
      "status": "pending",
      "description": "Replace Map operations in 7 test-suites route files with async DB calls"
    },
    {
      "id": 2116,
      "phase": 3,
      "category": "Backend/Routes",
      "name": "Migrate projects Route Files to Async DB Calls",
      "priority": "critical",
      "status": "pending",
      "description": "Replace Map operations in 7 projects route files with async DB calls"
    },
    {
      "id": 2117,
      "phase": 3,
      "category": "Backend/Routes",
      "name": "Migrate Auth and Organizations Routes to Async DB",
      "priority": "critical",
      "status": "pending",
      "description": "CRITICAL: Change getUserOrganization() to query organization_members table. Update all callers."
    },
    {
      "id": 2118,
      "phase": 3,
      "category": "Backend/Routes",
      "name": "Migrate test-runs Route Files to Async DB Calls",
      "priority": "high",
      "status": "pending",
      "description": "Replace Map operations in 37+ test-runs route files"
    },
    {
      "id": 2119,
      "phase": 3,
      "category": "Backend/Routes",
      "name": "Migrate Remaining Route Files to Async DB Calls",
      "priority": "high",
      "status": "pending",
      "description": "Replace Map operations in monitoring, github, sast, dast, api-keys, schedules, audit-logs route files"
    },
    {
      "id": 2120,
      "phase": 3,
      "category": "Backend/MCP",
      "name": "Migrate MCP Handlers to Async DB Calls",
      "priority": "high",
      "status": "pending",
      "description": "Update MCP server and handler files to use async DB functions instead of Map operations"
    },
    {
      "id": 2121,
      "phase": 4,
      "category": "QA/Verification",
      "name": "Final Verification - Zero Memory Maps in Codebase",
      "priority": "critical",
      "status": "pending",
      "description": "Grep verification: zero matches for getMemory, new Proxy, isDatabaseConnected, const memory in codebase"
    },
    {
      "id": 2122,
      "phase": 4,
      "category": "QA/Verification",
      "name": "End-to-End CRUD Verification After Memory Removal",
      "priority": "critical",
      "status": "pending",
      "description": "Login, create project/suite/tests, restart container, verify data persists. No 'not found' errors."
    }
  ]
}
